<!DOCTYPE html>
<head>
    <title>RoboWarJS</title>
    <link type="text/css" rel="stylesheet" href="css/layout.css"/>
    <script type="text/javascript">
        var DEBUG = !!window.location.href.indexOf(/(\?&)debug/);
    </script>
    <script type="text/javascript" src="lib/underscore-min.js"></script>
    <script type="text/javascript" src="lib/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" src="lib/knockout-2.1.0.debug.js"></script>
    <script type="text/javascript" src="lib/require.js" data-main="jswrapped/ui"></script>
</head>
<body>

    <div id="open-dialog" data-bind="with: world, animateVisible: world.openDialogVisible">
        <ol class="plain-list examples" data-bind="foreach: exampleRobots">
            <li data-bind="click: $parent.selectRobot, events: {dblclick: $parent.loadRobot}, css: {selected: $data === $parent.selectedRobot()}">
                <div class="name" data-bind="text: name"></div>
                <div class="description" data-bind="text: description"></div>
            </li>
        </ol>
        <div class="button-bar">
            <button data-bind="click: hideOpenDialog">Cancel</button>
            <button data-bind="click: loadRobot">Load</button>
        </div>
    </div>

    <div id="robot-list">
        <ol class="plain-list" data-bind="foreach: arena.robots">
            <li data-bind="click: $parent.selectRobot, css: {selected: $data === $parent.selectedRobot()}">
                <div class="icon" data-bind="spriteURL: spriteURL, tint: hue"></div>
                <div class="name" data-bind="text: name"></div>
                <div class="status">
                    <div data-bind="visible: !dead()">
                        <span class="label">Energy</span>
                        <span class="bar green"><span data-bind="style: {width: (100 * energy() / energyCapacity()) + '%'}"></span></span>
                    </div>
                    <div data-bind="visible: !dead()">
                        <span class="label">Damage</span>
                        <span class="bar red"><span data-bind="style: {width: (100 * damage() / damageCapacity()) + '%'}"></span></span>
                    </div>
                    <span data-bind="visible: dead">
                        dead
                        <span class="error" data-bind="text: runtimeError"></span>
                    </span>
                </div>
            </li>
        </ol>
        <div class="button-bar">
            <button data-bind="click: loadRobot, enable: arena.robots().length < arena.maxRobots && !arena.time()">+</button>
            <button data-bind="click: removeRobot, enable: selectedRobot() && !arena.time()">-</button>
        </div>
    </div>

    <div id="arena" data-bind="css: {animate: speed().delay > 0, 'flipped-y': flippedY}">
        <div class="layer robots" data-bind="foreach: arena.livingRobots">
            <div class="robot" data-bind="top: top, left: left, css: {selected: $data === $parent.selectedRobot()}">
                <div class="icon" data-bind="spriteURL: spriteURL, tint: hue, rotate: heading"></div>
                <div class="turret" data-bind="rotate: turretAngle"></div>
            </div>
        </div>
        <div class="layer projectiles" data-bind="foreach: arena.projectiles">
            <div data-bind="top: top, left: left, tint: shooter.hue, rotate: heading, attr: {class: type}">
            </div>
        </div>
    </div>

    <div id="controls">
        <div class="button-bar">
            <select data-bind="options: speedOptions, optionsText: 'label', value: speed, disable: running"></select>
            <button data-bind="click: run, visible: !running()">Run</button>
            <button data-bind="click: pause, visible: running">Pause</button>
            <button data-bind="click: reset, visible: !running()">Reset</button>
            <button data-bind="click: tick, visible: !running()">Tick</button>
            <button data-bind="click: debugStep, visible: !running(), enable: selectedRobot">Step</button>
        </div>
        <div class="status">
            Tick: <span data-bind="text: arena.time"></span>
        </div>
    </div>

    <div id="debugger" data-bind="with: selectedRobot">
        <div class="section instructions">
            <h4>Instructions</h4>
            <div class="debug-status" data-bind="visible: $root.debugPhase">
                <!-- ko if: $root.debugPhase() === 'execute-robot' -->
                <span data-bind="text: $root.debugInstruction() + 1"></span>/<span data-bind="text: clockSpeed"></span>
                <!-- /ko -->
                <!-- ko if: $root.debugPhase() !== 'execute-robot' -->
                <span data-bind="text: $root.debugPhase"></span>
                <!-- /ko -->
            </div>
            <ol class="plain-list instructions" data-bind="foreach: instructions">
                <li data-bind="
                        css: {current: $index() === $parent.ptr()},
                        click: $parent.highlightInstruction.bind($parent, $index()),
                        scrollIntoViewWhen: $index() === $parent.ptr()">
                    <span class="number" data-bind="text: $index"></span>
                    <span class="instruction" data-bind="text: $root.RoboCode.formatCode($data)"></span>
                </li>
            </ol>
        </div>

        <div class="section stack">
            <h4>Stack</h4>
            <ol class="plain-list stack" data-bind="foreach: $root.currentStack">
                <li>
                    <span class="number" data-bind="text: $index"></span>
                    <span class="value" data-bind="text: $root.RoboCode.formatCode($data)"></span>
                    <!-- ko if: $root.currentOperator -->
                        <span class="arg-name" data-bind="text: $root.currentOperator().args[$index()]"></span>
                    <!-- /ko -->
                </li>
            </ol>
        </div>

        <div class="section editor">
            <h4>
                <button data-bind="click: $root.showCode">Code</button>
                <button data-bind="click: $root.showHardware">Hardware</button>
                <button data-bind="click: $root.showStats">Stats</button>
                <button class="right" data-bind="click: compile">Build</button>
                <button class="right" data-bind="click: $root.saveRobot">Save</button>
            </h4>
            <div class="code" data-bind="visible: $root.editorTab() === 'code'">
                <textarea class="code" data-bind="value: code"></textarea>
            </div>
            <div class="hardware" data-bind="visible: $root.editorTab() === 'hardware'">
                hardware goes here
            </div>
            <div class="stats" data-bind="visible: $root.editorTab() === 'stats'">
                stats go here
            </div>
        </div>

        <div class="section registers">
            <h4>Registers</h4>
            <ul class="plain-list registers" data-bind="foreach: $root.RoboCode.registers">
                <li>
                    <span class="name" data-bind="text: sym"></span>
                    <span class="value" data-bind="text: $parent.getRegister(sym)"></span>
                    <!-- ko if: doc -->
                        <div class="doc" data-bind="text: doc"></div>
                    <!-- /ko -->
                </li>
            </ul>
        </div>
    </div>
</body>
</html>
